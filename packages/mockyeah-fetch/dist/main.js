module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=21)}([function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("lodash/isPlainObject")},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("match-deep")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports=require("lodash/isEqual")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("cookie")},function(e,t){e.exports=require("lodash/flatten")},function(e,t){e.exports=require("lodash/fromPairs")},function(e,t){e.exports=require("path-to-regexp")},function(e,t){e.exports=require("lodash/isRegExp")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("@babel/runtime/helpers/typeof")},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),a=r(6),c=r.n(a),i=r(5),s=r.n(i),u=r(11),l=r.n(u),p=r(12),f=r.n(p),h=r(4),d=r.n(h),m=r(7),y=r(13),b=r.n(y),v=r(1),k=r.n(v),x=r(15),g=r.n(x),w=r(16),P=r.n(w),O=r(14),q=r.n(O),j=r(3),S=r.n(j),_=r(8),E=r.n(_),R=r(17),$=r.n(R),W=r(9),H=r.n(W),C=r(18),T=r.n(C);function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(r,!0).forEach((function(t){d()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var M=/^(\/?https?.{3}[^/:?]+):/,N=/^(\/?https?).{3}/,F=/^(\/?https?.{3}[^/:?]+)~/,U=/^(\/?https?).{3}/,J=function(e){return e.replace(U,"$1://").replace(F,"$1:")},A=function(e){return e.replace(M,"$1~").replace(N,"$1~~~")},B=/^\//,I=/^(https?)%3A%2F%2F/,K=function(e){return/^\/+https?[:~][/~]{2}/.test(e)?J(function(e){return e.replace(B,"")}(e).replace(I,(function(e,t){return"".concat(t,"://")}))):e},z=function(e,t){if("function"==typeof e)return e;var r=k()(e)?L({},e):e;(e=k()(e)?L({},e):{url:e}).query=H()(e.query)?void 0:e.query,e.headers=H()(e.headers)?void 0:Object.entries(e.headers).reduce((function(e,t){var r=c()(t,2),n=r[0],o=r[1];return e[n.toLowerCase()]=o,e}),{}),e.method?"all"===e.method||"ALL"===e.method||"*"===e.method?delete e.method:"string"==typeof e.method&&(e.method=e.method.toLowerCase()):e.method="get";var n,o,a=L({},e.$meta||{});if(e.path&&(e.url=e.path,delete e.path),"*"===e.url&&delete e.url,"string"==typeof e.url){e.url=K(e.url);var i=(n=e.url,/^https?:/.test(n)?(o=Object(m.parse)(n),n="".concat(o.protocol||"http:","//").concat(o.hostname).concat(o.port&&!["80","443"].includes(o.port)?":".concat(o.port):"").concat(o.pathname)):(o=Object(m.parse)("http://example.com".concat(n.startsWith("/")?n:"/".concat(n))),n=o.pathname||""),{url:n,query:o.query?b.a.parse(o.query):void 0});e.url=i.url.replace(/\/+$/,""),e.url=e.url||"/",e.query=k()(e.query)?L({},i.query,{},e.query):e.query||i.query}H()(e.query)&&delete e.query,H()(e.cookies)&&delete e.cookies;var s=L({},e);if(a.original=r,a.originalNormal=s,"string"==typeof e.url){if(!t){var u=[],l=$()(A(e.url),u);e.url=function(e){return l.test(A(e)||A("/".concat(e)))},a.regex=l,a.matchKeys=u,a.fn=e.url.toString()}}else if(T()(e.url)){if(!t){var p=e.url;e.url=function(e){return p.test(J(e))||p.test(J("/".concat(e)))},a.regex=p,a.fn=e.url.toString()}}else if("function"==typeof e.url){var f=e.url;e.url=function(e){return f(e)||f("/".concat(e))}}return e.$meta=a,e},G=r(10),Q=r.n(G),V=r(19),X=r.n(V);function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(r,!0).forEach((function(t){d()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ee=function(e,t){return"function"==typeof e?e(t):e},te=function(e,t,r){var n,a,c,i,s,u,l,p,f,h,d,m,y,b,v;return o.a.async((function(k){for(;;)switch(k.prev=k.next){case 0:if(n=r.responseHeaders,a=e[1]||{},k.t1=a.status,!k.t1){k.next=7;break}return k.next=6,o.a.awrap(ee(a.status,t));case 6:k.t1=k.sent;case 7:if(k.t0=k.t1,k.t0){k.next=10;break}k.t0=200;case 10:if(c=k.t0,k.t2=a.type,!k.t2){k.next=16;break}return k.next=15,o.a.awrap(a.type);case 15:k.t2=k.sent;case 16:if(s=k.t2,u="function"==typeof s?s(t):s,!a.fixture){k.next=35;break}if(r.fixtureResolver){k.next=21;break}throw new Error("Using `fixture` in mock response options requires a `fixtureResolver`.");case 21:return k.next=23,o.a.awrap(ee(a.fixture,t));case 23:if(f=k.sent,u=u||f,!f){k.next=31;break}return k.next=28,o.a.awrap(r.fixtureResolver(f));case 28:k.t3=k.sent,k.next=32;break;case 31:k.t3=void 0;case 32:i=k.t3,k.next=79;break;case 35:if(!a.filePath){k.next=52;break}if(r.fileResolver){k.next=38;break}throw new Error("Using `filePath` in mock response options requires a `fileResolver`.");case 38:return k.next=40,o.a.awrap(ee(a.filePath,t));case 40:if(h=k.sent,u=u||h,!h){k.next=48;break}return k.next=45,o.a.awrap(r.fileResolver(h));case 45:k.t4=k.sent,k.next=49;break;case 48:k.t4=void 0;case 49:i=k.t4,k.next=79;break;case 52:if(!a.json){k.next=60;break}return k.next=55,o.a.awrap(ee(a.json,t));case 55:p=k.sent,i=JSON.stringify(p),l="application/json; charset=UTF-8",k.next=79;break;case 60:if(!a.text){k.next=67;break}return k.next=63,o.a.awrap(ee(a.text,t));case 63:i=k.sent,l="text/plain; charset=UTF-8",k.next=79;break;case 67:if(!a.html){k.next=74;break}return k.next=70,o.a.awrap(ee(a.html,t));case 70:i=k.sent,l="text/html; charset=UTF-8",k.next=79;break;case 74:if(!a.raw){k.next=79;break}return k.next=77,o.a.awrap(ee(a.raw,t));case 77:i=k.sent,l=void 0;case 79:if(i=i||"",l=u?X.a.getType(u):l,!a.headers){k.next=90;break}return k.t6=Z,k.t7={},k.next=86,o.a.awrap(ee(a.headers,t));case 86:k.t8=k.sent,k.t5=(0,k.t6)(k.t7,k.t8),k.next=91;break;case 90:k.t5={};case 91:if(d=k.t5,n&&(d["x-mockyeah-mocked"]="true"),l&&(d["content-type"]=l),m={status:c,headers:d},!(y=a.latency||r.latency)){k.next=102;break}return k.next=99,o.a.awrap(ee(y,t));case 99:return b=k.sent,k.next=102,o.a.awrap(new Promise((function(e){return setTimeout(e,b)})));case 102:return v=new Response(i,m),k.abrupt("return",{response:v,json:p});case 104:case"end":return k.stop()}}))},re=r(20),ne=r.n(re),oe=r(2),ae=r.n(oe),ce=function(e){return e&&(e instanceof Promise||!(!e.then||!e.catch))},ie=function(e,t,r){var n=E()(e,t,{skipKeys:["$meta"]}),o=n.result,a=n.message;ae()(o,"".concat(r,": ").concat(a))},se=function(){function e(t){l()(this,e);var r=t.$meta&&t.$meta.originalNormal?t.$meta.originalNormal:t;this.prefix="[".concat(r.method||"get","] ").concat(r.path||r.url," --"),this.called=0,this.assertions=[],this.handlers=[],this.verifier=this.verifier.bind(this),this.run=this.run.bind(this),this.verify=this.verify.bind(this)}return f()(e,[{key:"request",value:function(e){var t=this;this.called+=1,this.handlers.forEach((function(r){t.assertions.push(r.bind(t,e))}))}},{key:"api",value:function(e){var t=this;if("function"==typeof e){var r=e;this.handlers.push((function(e){try{var n=r(e);if(void 0!==n&&!n)throw new Error("function returned false")}catch(e){var o="".concat(t.prefix," Expect function did not match").concat(e&&e.message?": ".concat(e.message):"");ae()(!1,o)}}))}else if("object"===ne()(e)){var n=z(e);this.handlers.push((function(e){var t=E()(e,n,{skipKeys:["$meta"]}),r=t.result,o=t.message;ae()(r,"Expect object did not match: ".concat(o))}))}return this}},{key:"atLeast",value:function(e){var t=this;return this.assertions.push((function(){ae()(t.called>=e,"".concat(t.prefix," Expected route to be called at least ").concat(e," times, but it was called ").concat(t.called," times"))})),this}},{key:"atMost",value:function(e){var t=this;return this.assertions.push((function(){ae()(t.called<=e,"".concat(t.prefix," Expected route to be called at most ").concat(e," times, but it was called ").concat(t.called," times"))})),this}},{key:"never",value:function(){var e=this;return this.assertions.push((function(){ae()(0===e.called,"".concat(e.prefix," Expected route to be called never, but it was called ").concat(e.called," times"))})),this}},{key:"once",value:function(){var e=this;return this.assertions.push((function(){ae()(1===e.called,"".concat(e.prefix," Expected route to be called once, but it was called ").concat(e.called," times"))})),this}},{key:"twice",value:function(){var e=this;return this.assertions.push((function(){ae()(2===e.called,"".concat(e.prefix," Expected route to be called twice, but it was called ").concat(e.called," times"))})),this}},{key:"thrice",value:function(){var e=this;return this.assertions.push((function(){ae()(3===e.called,"".concat(e.prefix," Expected route to be called thrice, but it was called ").concat(e.called," times"))})),this}},{key:"exactly",value:function(e){var t=this;return this.assertions.push((function(){ae()(t.called===e,"".concat(t.prefix," Expected route to be called ").concat(e," times, but it was called ").concat(t.called," times"))})),this}},{key:"path",value:function(e){var t="".concat(this.prefix," Path did not match expected");return this.handlers.push((function(r){var n=r.path;ie(n,e,t)})),this}},{key:"url",value:function(e){return this.path(e)}},{key:"header",value:function(e,t){var r="".concat(this.prefix,' Header "').concat(e,'" did not match expected');return this.handlers.push((function(n){ie(n.headers&&(n.headers[e]||n.headers[e.toLowerCase()]),t,r)})),this}},{key:"params",value:function(e){var t="".concat(this.prefix," Params did not match expected");return this.handlers.push((function(r){ie(r.query||{},e||{},t)})),this}},{key:"query",value:function(e){return this.params(e)}},{key:"body",value:function(e){var t="".concat(this.prefix," Body did not match expected");return this.handlers.push((function(r){ie(r.body,e,t)})),this}},{key:"verifier",value:function(e){var t=this;return function(r){r?e(r):t.verify(e)}}},{key:"run",value:function(e){return ce(e)?this.runPromise=e:this.runPromise=new Promise((function(t,r){setTimeout((function(){var n=e((function(e){e?r(e):t()}));ce(n)&&n.then(t).catch(r)}))})),this}},{key:"verify",value:function(e){var t=this,r=function(t){if(!e)throw t;e(t)},n=function(){try{t.assertions.forEach((function(e){return e()})),e&&e()}catch(e){r(e)}};if(this.runPromise)return this.runPromise.then(n).catch(r);n()}}]),e}(),ue=function(e){return o.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(204!==e.status){t.next=3;break}return t.abrupt("return","");case 3:return t.abrupt("return",e.text()||"");case 4:case"end":return t.stop()}}))};function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(r,!0).forEach((function(t){d()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var fe=S()("mockyeah:fetch:mock"),he=S()("mockyeah:fetch:hit"),de=S()("mockyeah:fetch:miss"),me=S()("mockyeah:fetch:miss:each"),ye=S()("mockyeah:fetch:error"),be=S()("mockyeah:fetch:admin"),ve=S()("mockyeah:fetch:admin:error"),ke={},xe=function(e,t){return pe({},k()(e)?e:{url:e},{method:t})},ge=function(e){var t=e.name,r=void 0===t?"default":t,n=e.noProxy,o=void 0!==n&&n,a=e.prependServerURL,c=void 0!==a&&a,i=e.noPolyfill,s=void 0!==i&&i,u=e.noWebSocket,l=void 0!==u&&u,p=e.webSocketReconnectInterval,f=void 0===p?5e3:p,h=e.host,d=void 0===h?"localhost":h,m=e.port,y=void 0===m?4001:m,b=e.portHttps,v=e.adminHost,k=void 0===v?d:v,x=e.adminPort,g=void 0===x?4777:x,w=e.suiteHeader,P=void 0===w?"x-mockyeah-suite":w,O=e.suiteCookie,q=void 0===O?"mockyeahSuite":O,j=e.ignorePrefix,S=void 0===j?"http".concat(b?"s":"","://").concat(d,":").concat(b||y,"/"):j,_=e.aliases,E=void 0===_?[]:_,R=e.responseHeaders,$=void 0===R||R,W=e.fetch;return{name:r,noProxy:o,prependServerURL:c,noPolyfill:s,noWebSocket:l,webSocketReconnectInterval:f,host:d,port:y,portHttps:b,adminHost:k,adminPort:g,suiteHeader:P,suiteCookie:q,ignorePrefix:S,aliases:E,responseHeaders:$,fetch:void 0===W?global.fetch:W,fileResolver:e.fileResolver,fixtureResolver:e.fixtureResolver,mockSuiteResolver:e.mockSuiteResolver}},we=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke;l()(this,e);var r=ge(t),n=r.name,o=r.noPolyfill,a=r.noWebSocket,c=r.aliases,i=r.fetch;this.__private={recording:!1,bootOptions:r,logPrefix:"[".concat(n,"]"),mocks:[]};var s=this.__private.logPrefix;if(!i){var u="".concat(s," @mockyeah/fetch requires a fetch implementation");throw ye(u),new Error(u)}if(!a)try{this.connectWebSocket()}catch(e){}var p={};(c||[]).forEach((function(e){e.forEach((function(t){p[t]=e}))})),this.__private.aliasReplacements=p,o||(global.fetch=this.fetch.bind(this));var f={all:this.all.bind(this),get:this.get.bind(this),post:this.post.bind(this),put:this.put.bind(this),delete:this.delete.bind(this),options:this.options.bind(this),patch:this.patch.bind(this)};this.methods=f}return f()(e,[{key:"fetch",value:function(e,t){var r,n,a,i,u,l,p,f,h,y,v,x,w,P,O,j,S,_,R,$,W,H,C,T,D,L,M,N,F,U,J,A,B,I,K,G,Q,V,X,Y,Z,ee,re,ne,oe,ae,ce,ie=this,se=arguments;return o.a.async((function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(r=se.length>2&&void 0!==se[2]?se[2]:{},n=this.__private,a=n.logPrefix,i=n.mocks,u=n.bootOptions,l=n.aliasReplacements,p=u.noWebSocket,f=u.ignorePrefix,h=u.noProxy,y=u.prependServerURL,v=u.suiteCookie,x=u.suiteHeader,w=u.port,P=u.portHttps,O=u.host,j=u.mockSuiteResolver,S=r.dynamicMocks,_=r.dynamicMockSuite,R=r.noProxy,$=void 0===R?h:R,p){ue.next=12;break}return ue.prev=5,ue.next=8,o.a.awrap(this.connectWebSocket());case 8:ue.next=12;break;case 10:ue.prev=10,ue.t0=ue.catch(5);case 12:if(W="string"==typeof e?e:e.url,H=t||{},C=(S||[]).map((function(e){return e&&ie.makeMock.apply(ie,s()(e))})).filter(Boolean),T=Object(m.parse)(W),D=H.headers?H.headers instanceof Headers?H.headers:new Headers(H.headers):void 0,!H.body||"string"==typeof H.body){ue.next=20;break}return ye("".concat(a," @mockyeah/fetch does not yet support non-string request bodies, falling back to normal fetch")),ue.abrupt("return",this.fallbackFetch(W,t,{noProxy:$}));case 20:if(L=D&&D.get("Content-Type"),M=L&&L.includes("application/json"),N=H.body&&M?JSON.parse(H.body):H.body,F=T.query?b.a.parse(T.query):void 0,U=H.method?H.method.toLowerCase():"get",!H.headers||k()(H.headers)){ue.next=28;break}return ye("".concat(a," @mockyeah/fetch does not yet support non-object request headers, falling back to normal fetch")),ue.abrupt("return",this.fallbackFetch(W,t,{noProxy:$}));case 28:J=H.headers;try{(B=J&&(J.cookie||J.Cookie))?A=q.a.parse(B):"undefined"!=typeof window&&(A=q.a.parse(window.document.cookie))}catch(e){ye("".concat(a," @mockyeah/fetch couldn't parse cookies: ").concat(e.message))}if(!(I=_||A&&A[v])||!j){ue.next=38;break}return K=I.split(",").map((function(e){return e.trim()})),G=K.map(j),ue.next=36,o.a.awrap(Promise.all(G));case 36:ue.sent.forEach((function(e,t){var r=K[t];e.default.forEach((function(e){var t=c()(e,2),n=t[0],o=t[1],a=k()(n)?pe({},n):{url:n};a.cookies=pe({},a.cookies,{mockSuite:function(e){return!!e&&e.split(",").map((function(e){return e.trim()})).includes(r)}}),C.push(ie.makeMock(a,o))}))}));case 38:if([Q={url:W.replace(f,""),query:F,headers:J,body:N,method:U,cookies:A}].concat(s()(g()(l&&Object.entries(l).map((function(e){var t=c()(e,2),r=t[0],n=t[1];return Q.url.replace(/^\//,"").startsWith(r)?n.map((function(e){return pe({},Q,{url:W.replace(r,e)})})):[]}))))).filter(Boolean).find((function(e){var t=z(e,!0);return[].concat(s()((C||[]).filter(Boolean)),s()(i)).find((function(e){var r=z(e[0]),n=E()(t,r,{skipKeys:["$meta"]});return n.result?(V=e,!0):(me("".concat(a," @mockyeah/fetch missed mock for"),W,n.message,{request:Q}),!1)}))})),X=T.pathname||"/",Y={url:X,path:X,query:F,method:U,headers:J,body:N,cookies:A},!V){ue.next=51;break}return V[0]&&V[0].$meta&&V[0].$meta.expectation&&V[0].$meta.expectation.request(Y),ue.next=46,o.a.awrap(te(V,Y,u));case 46:return Z=ue.sent,ee=Z.response,re=Z.json,he("".concat(a," @mockyeah/fetch matched mock for"),W,{request:Y,response:ee,json:re,mock:V}),ue.abrupt("return",ee);case 51:return de("".concat(a," @mockyeah/fetch missed all mocks for"),W,{request:Y}),ne="http".concat(P?"s":"","://").concat(O,":").concat(P||w),oe=H,y&&ne&&(W="".concat(ne,"/").concat(W.replace("://","~~~")),"undefined"!=typeof document&&(ce=document.cookie.match("\\b".concat(v,"=([^;]+)\\b")),ae=ce&&ce[1]),oe=pe({},H,{headers:pe({},H.headers,{},ae&&d()({},x,ae))})),ue.abrupt("return",this.fallbackFetch(W,oe,{noProxy:$}));case 56:case"end":return ue.stop()}}),null,this,[[5,10]])}},{key:"fallbackFetch",value:function(e,t){var r,n,a,c,i,u,l,p,f,h,d,m,y,b,v,k,x,g,w,O=arguments;return o.a.async((function(q){for(;;)switch(q.prev=q.next){case 0:if(r=O.length>2&&void 0!==O[2]?O[2]:{},n=r.noProxy,a=this.__private.bootOptions.responseHeaders,c="string"==typeof e?e:e.url,!n&&c.startsWith("http")){q.next=8;break}return i={},a&&(i["x-mockyeah-missed"]="true"),q.abrupt("return",new Response("",{status:404,headers:i}));case 8:return u=(new Date).getTime(),q.next=11,o.a.awrap(fetch(e,t));case 11:return l=q.sent,q.next=14,o.a.awrap(ue(l));case 14:return p=q.sent,f=this.__private,h=f.ws,f.recording&&(d=l.status,m=l.headers.entries(),y=P()(s()(m).map((function(e){return[e[0].toLowerCase(),e[1]]}))),h&&(b={type:"recordPush",payload:{reqUrl:c,req:{method:t&&t.method,body:t&&t.body},startTime:u,body:p,headers:y,status:d}},h.send(JSON.stringify(b)))),a&&(k=(v=l).status,x=v.statusText,g=v.headers,(w=g&&new Headers(g))&&(w.set("x-mockyeah-proxied","true"),w.set("x-mockyeah-missed","true")),l=new Response(p,{headers:w,status:k,statusText:x})),q.abrupt("return",l);case 19:case"end":return q.stop()}}),null,this)}},{key:"expect",value:function(e){return this.all("*").expect(e)}},{key:"all",value:function(e,t){return this.mock(e,t)}},{key:"get",value:function(e,t){return this.mock(xe(e,"get"),t)}},{key:"post",value:function(e,t){return this.mock(xe(e,"post"),t)}},{key:"put",value:function(e,t){return this.mock(xe(e,"put"),t)}},{key:"delete",value:function(e,t){return this.mock(xe(e,"delete"),t)}},{key:"options",value:function(e,t){return this.mock(xe(e,"options"),t)}},{key:"patch",value:function(e,t){return this.mock(xe(e,"patch"),t)}},{key:"reset",value:function(){this.__private.mocks=[]}},{key:"makeMock",value:function(e,t){var r=z(e),n=this.__private.mocks,o=n.findIndex((function(e){return t=r,n=e[0],o=t.$meta?t.$meta.originalNormal:void 0,a=n.$meta?n.$meta.originalNormal:void 0,k()(o)&&k()(a)?!(!o||!a)&&o.url===a.url&&o.path===a.path&&o.method===a.method&&Q()(o.query,a.query)&&Q()(o.body,a.body)&&Q()(o.headers,a.headers)&&Q()(o.cookies,a.cookies):o===a;var t,n,o,a}));o>=0&&n.splice(o,1);var a="string"==typeof t?{text:t}:t;return a=a||{status:200},r.$meta&&(r.$meta.expectation=new se(r)),[r,a]}},{key:"mock",value:function(e,t){var r=this.makeMock(e,t),n=this.__private,o=n.mocks,a=n.logPrefix;fe("".concat(a," mocked"),e,t),o.push(r);var c=r[0].$meta&&r[0].$meta.expectation,i=c.api.bind(c);return{expect:function(e){return i(e)}.bind(c)}}},{key:"connectWebSocket",value:function(){var e,t,r,n,a,c,i,s,u=this,l=arguments;return o.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(e=l.length>0&&void 0!==l[0]?l[0]:{},t=e.retries,r=void 0===t?1/0:t,"undefined"!=typeof WebSocket){p.next=3;break}return p.abrupt("return");case 3:if(!this.__private.ws){p.next=5;break}return p.abrupt("return");case 5:return n=this.__private.bootOptions,a=n.webSocketReconnectInterval,c=n.adminPort,i=n.adminHost,s="ws://".concat(i,":").concat(c),be("WebSocket trying to connect to '".concat(s,"'.")),p.next=10,o.a.awrap(new Promise((function(e,t){try{u.__private.ws=new WebSocket(s)}catch(e){ve("WebSocket couldn't connect to '".concat(s,"':"),e)}var n=u.__private.ws;n&&(n.onopen=function(){be("WebSocket opened"),n.send(JSON.stringify({type:"opened"})),e()},n.onerror=function(e){ve("WebSocket errored",e),t()},n.onclose=function(){ve("WebSocket closed"),be("WebSocket will try to re-connect in ".concat(a," milliseconds.")),delete u.__private.ws,r>0&&setTimeout((function(){u.connectWebSocket({retries:r-1})}),a),t()},n.onmessage=function(e){var t;be("WebSocket message",e);try{t=JSON.parse(e.data)}catch(t){return void ve("Couldn't parse WebSocket message data '".concat(e.data,"':"),t)}t&&(be("WebSocket action",t),"record"===t.type?u.__private.recording=!0:"recordStop"===t.type&&(u.__private.recording=!1))})})));case 10:case"end":return p.stop()}}),null,this)}}]),e}();t.default=we}]).default;